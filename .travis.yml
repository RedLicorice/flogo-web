sudo: required
language: node_js
addons:
  apt:
    # needed for cypress https://github.com/cypress-io/cypress/issues/1526
    packages:
      - libgconf-2-4
node_js:
  - "10"
cache:
  bundler: false
  yarn: true
  directories:
    - .build-cache
    - ~/.cache
git:
  submodules: false
install: yarn install --frozen-lockfile --non-interactive --audit --silent

jobs:
  include:
    - stage: client e2e tests & build
      name: "Client E2E tests & build the docker image"
      services:
        - docker
      script: |
        set -e
        RELEASE_VERSION=latest ./make-web.sh
        docker run -d -p 3303:3303 flogo/flogo-web:latest eula-accept
        sudo apt-get install libgtk2.0-0 libgtk-3-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2 libxtst6 xauth xvfb
        yarn run e2e-client:ci
